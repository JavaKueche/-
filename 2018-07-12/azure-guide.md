# やること
Azure実践ガイド


# 第1章のサンプルアプリの構築

##  基本構成
ロードバランサー 1 
     /    \
    VM     VM
     \     /
    SQL Server

## ResourceGroupの作成
ResourceGroupというのはAzureの各リソースを論理的な単位でグルーピングするためのもの。
ResourceGroupを作ってその中にサービスを構築することであとで参照したり、すべてのサービスを一斉に削除したりしやすくなっている。

## Virtual Networkの作成
そのあとVirtual Network(仮想ネットワーク、VNet)の構築を行った。
仮想ネットワークはAzure内に作る専用のプライベートネットワークで、他のユーザーとは論理的に分離されたネットワーク環境が構築できる。
VNetにはアドレス空間(例: 10.0.0.0/16)、サブネット名(例: web)とサブネットのアドレス範囲(例: 10.0.0.0/24)を設定して構築できる。
VNetのアドレス空間の範囲であれば、サブネットを複数作ることもできる。

## Network Security Groupの作成
そのあとネットワークセキュリティグループ(NSG)の構築を行った。
NSGはVnetに接続されたリソースへのネットワークトラフィックを許可または拒否するセキュリティ規則で、サブネットと仮想マシンのネットワークインターファイス(NIC)に設定できます。
ひとつのNSGを別々のサブネットやNICに接続することも可能です。

## 可用性セットの作成
可用性セットの構築をおこなった。
可用性セットとは、Azureで仮想マシンの冗長構成を取るための論理的なグループです。
可用性セットを使って複数のVMをグルーピングすると、その複数のVMは電源やネットワーク機器などを共有する範囲(障害ドメイン)を分散して配置されるようになります。
またホストのパッチ適用などのメンテナンスが可用性セット内のマシンで同時に実行されないようになります(更新ドメイン)

## Azure Load Balancerの作成
Azure Load Balancerの作成を行った
Azureにはロードバランサーのサービスが複数あります。
- Azure Load Balancer(L4までの負荷分散)
- Application Gateway(L7層での負荷分散、WAFの機能やパスによるルーティング機能もあり)
- Traffic Manager(DNSレベルでの広域負荷分散)

今回はAzure Load Balancerを利用した。

LoadBalancerの設定には以下の項目が必要
- バックエンドプールの作成
- 正常性プルーフの作成
- 負荷分散規則の作成

### バックエンドプールの作成
バックエンドプールとは、ロードバランサーの配下に設定するリソースのこと。
設定は以下の単位で設定できる。
- 単一のVM単位、
- 可用性セットの単位
- 仮想マシンのスケールセットの単位
今回は可用性セットの単位で設定した。

### 正常性プルーフの作成
正常性プルーフとは、パックエンドプールが正常に動いているか検証するための仕組みのことです。
TCPでの接続での検証、または HTTPでリクエストのパスを指定してそれが200を返すかで検証することができます。
正常性プルーフによって正常でないと判断されるとそのバックエンドプールにトラフィックが流れないようになります。

### 負荷分散規則の作成
負荷分散規則とは、VMに対するトラフィックの分散方法を定義するための仕組みです。
着信トラフィック用のフロントエンドIPとトラフィックを受信するためのバックエンドIPプールを必要な発信元ポートと宛先ポートともに定義します。
ここで先程作成したバックエンドプールの設定(どこにトラフィックを流すか)や正常性プルーフも設定(正常性を判断するルールはなにか)します。

### SQL Serverの作成
SQL Serverは普通にサービスつくっただけです。



